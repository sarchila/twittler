<!DOCTYPE html>
<html>
  <head>
    <title>Twittler by Santiago Archila</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="underbar.js"></script>
    <style type="text/css">
      body {
        color: rgb(82, 189, 167);
        background-color: #2A524B 
      }
      .tweets {
        font: 20px arial,sans-serif;
        color: #FFFFFF;
      }
      #logo {
        font: 180px arial,sans-serif;
        text-align: center;
      }

      #logo:hover {
        color: rgb(37, 224, 186);
        cursor: pointer;
      }
      
      .upper {
        text-align: center;
        font: 14px arial,sans-serif;
      }
      .lower {
        text-align: center;
        font: 14px arial,sans-serif;
      }
      .handles {
        font: 20px arial,sans-serif;
        color: rgb(82, 189, 167);
      }

      .handles:hover {
        color: rgb(37, 224, 186);
        cursor: pointer;
      }

      .timestamps {
        font: 14px arial,sans-serif;
        color: gray;
      }
    </style>
  </head>
  <body>
    <script>
      $(document).ready(function(){
        var $tweethousing = $('.tweethousing');
        var oldestTweetInd = 0;
        var newestTweetInd = streams.home.length-1;
        
        var oldTweetButton = $('<button type="button" class="getOld">Show Older Tweets</button>');
        var addOnce = _.once(function(arg){
          $('.lower').append(arg);
        });

        var createTweetNode = function(tweet){
          var $tweet = $('<div class="fullTweetLines"></div>');
          $tweet.html('<span class="handles">@' + tweet.user + '</span>: <span class="tweets">' + tweet.message + '</span> <span class="timestamps">' + tweet.created_at + "</span>");
          return $tweet;
        }

        var getOldestInd = function(stream){

          var oldestInd;
          if (stream.length>20){
            oldestInd = stream.length-20;
            addOnce(oldTweetButton);
            $('.getOld').on('click', function(){
              console.log("get older tweets");
            });
          } else {
            oldestInd = 0;
          }
          return oldestInd;
        }

        var displayNewTweets = function(tweetsToDisplay, oldInd, newInd, whichDiv){

          for (var index = oldInd; index <= newInd; index++){
            var tweet = tweetsToDisplay[index];
            var $tweet = createTweetNode(tweet);
            $tweet.prependTo(whichDiv);
          }
          
          oldestTweetInd = oldInd;
          newestTweetInd = newInd;

          $('.handles').on('click', function(){
            $('.fullTweetLines').remove();
            var userStream = streams.users[$(this).text().slice(1)];
            newestTweetInd = userStream.length-1;
            oldestTweetInd = getOldestInd(userStream);
            // console.log([userStream, oldestTweetInd,newestTweetInd]);
            displayNewTweets(userStream,oldestTweetInd,newestTweetInd,$tweethousing);
            $('.getNew').text('Show All Users');
            $('.getNew').on('click', function(){
              $('.getNew').text('Get New Tweets');
            });
          });
        }

        var getFromAllUsers = function(){
          if (streams.home.length>20){
            $('.fullTweetLines').remove();
            var oldInd = getOldestInd(streams.home);
            displayNewTweets(streams.home,oldInd,streams.home.length-1,$tweethousing);
          } else {
            displayNewTweets(streams.home,newestTweetInd+1,streams.home.length-1,$tweethousing);
            oldestTweetInd = 0;
          }
          // console.log([streams.home, oldestTweetInd,newestTweetInd]);
        }

        displayNewTweets(streams.home,oldestTweetInd,newestTweetInd,$tweethousing);

        $('.getNew').on('click', getFromAllUsers);
        $('#logo').on('click', getFromAllUsers);


      });
    </script>

    <div class="upper">
      <span id='logo'>twittler</span>by Santiago Archila<br>
      <button type="button" class="getNew">Get New Tweets</button></div>
    <div class="tweethousing"></div>
    <div class="lower"></div>
  </body>
</html>

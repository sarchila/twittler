<!DOCTYPE html>
<html>
  <head>
    <title>Twittler by Santiago Archila</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="underbar.js"></script>
    <style type="text/css">
      body {
        background-color: #2A524B 
      }
      .tweets {
        font: 15px arial,sans-serif;
        color: rgb(82, 189, 167);
      }
      .upper {
        text-align: center;
      }
      .lower {
        text-align: center;
      }
      .timestamp {
        font: 10px arial,sans-serif;
        color: gray;
      }
    </style>
  </head>
  <body>
    <script>
      $(document).ready(function(){
        var $tweethousing = $('.tweethousing');

        var oldestTweet = 0;
        var newestTweet;
        var displayedTweets;
        var oldTweetButton = $('<button type="button">Show Older Tweets</button>');
        var addToLowerOnce = _.once(function(arg){
          $('.lower').append(arg);
        });

        var getNewTweets = function(){

          if (streams.home.length>20){
            displayedTweets = streams.home.slice(-20);
            oldestTweet = 0;
            $tweethousing.html(' ');
            addToLowerOnce(oldTweetButton);
          } else {
            displayedTweets = streams.home;
          }

          newestTweet = displayedTweets.length-1;
          var index = oldestTweet;
          while(index <= newestTweet){
            var tweet = displayedTweets[index];
            var $tweet = $('<div class="tweets"></div>');
            $tweet.html('@' + tweet.user + ': ' + tweet.message + ' <span class="timestamp">' + tweet.created_at + "</span>");
            $tweet.prependTo($tweethousing);
            index++;
          }
          oldestTweet = newestTweet+1;
        }

        getNewTweets();

        $('button').on('click', getNewTweets);

      });
    </script>

    <div class="upper">
    <button type="button">Get New Tweets</button>
    </div>
    <div class="tweethousing">
    </div>
    <div class="lower">
    </div>
  </body>
</html>

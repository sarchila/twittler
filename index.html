<!DOCTYPE html>
<html>
  <head>
    <title>Twittler by Santiago Archila</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="underbar.js"></script>
    <style type="text/css">
      body {
        background-color: #2A524B 
      }
      .tweets {
        font: 20px arial,sans-serif;
        color: #FFFFFF;
      }
      .upper {
        text-align: center;
      }
      .lower {
        text-align: center;
      }
      .handles {
        font: 20px arial,sans-serif;
        color: rgb(82, 189, 167);
      }
      .timestamps {
        font: 14px arial,sans-serif;
        color: gray;
      }
    </style>
  </head>
  <body>
    <script>
      $(document).ready(function(){
        var $tweethousing = $('.tweethousing');

        var oldestTweet = 0;
        var newestTweet;
        var displayedTweets;
        var oldTweetButton = $('<button type="button">Show Older Tweets</button>');
        var addOnce = _.once(function(arg){
          $('.lower').append(arg);
        });

        var getNewTweets = function(stream){

          if (stream.length>20){
            displayedTweets = stream.slice(-20);
            oldestTweet = 0;
            $tweethousing.html(' ');
            addOnce(oldTweetButton);
          } else {
            displayedTweets = stream;
          }

          newestTweet = displayedTweets.length-1;
          var index = oldestTweet;
          while(index <= newestTweet){
            var tweet = displayedTweets[index];
            var $tweet = $('<div></div>');
            $tweet.html('<span class="handles">@' + tweet.user + ':</span> <span class="tweets">' + tweet.message + '</span> <span class="timestamps">' + tweet.created_at + "</span>");
            $tweet.prependTo($tweethousing);
            index++;
          }
          oldestTweet = newestTweet+1;
        }


        getNewTweets(streams.home);

        $('button').on('click', function(){getNewTweets(streams.home);});

      });
    </script>

    <div class="upper"><button type="button">Get New Tweets</button></div>
    <div class="tweethousing"></div>
    <div class="lower"></div>
  </body>
</html>
